!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Vue3Mask={})}(this,(function(e){"use strict";const t="_",n=[];function r(e=n,r=t){if(!o(e))throw new Error("Text-mask:convertMaskToPlaceholder; The mask property must be an array.");if(-1!==e.indexOf(r))throw new Error(`Placeholder character must not be used as part of the mask. Please specify a character that is not present in your mask as your placeholder character.\n\nThe placeholder character that was received is: ${JSON.stringify(r)}\n\nThe mask that was received is: ${JSON.stringify(e)}`);return e.map((e=>e instanceof RegExp?r:e)).join("")}function o(e){return Array.isArray&&Array.isArray(e)||e instanceof Array}const i="[]";const a=[],u="";function c(e=u,n=a,c={}){if(!o(n)){if("function"!=typeof n)throw new Error("Text-mask:conformToMask; The mask property must be an array.");n=function(e){const t=[];let n;for(;n=e.indexOf(i),-1!==n;)t.push(n),e.splice(n,1);return{maskWithoutCaretTraps:e,indexes:t}}(n=n(e,c)).maskWithoutCaretTraps}const{guide:l=!0,previousConformedValue:s=u,placeholderChar:f=t,placeholder:p=r(n,f),currentCaretPosition:d,keepCharPositions:h}=c,v=!1===l&&void 0!==s,y=e.length,g=s.length,m=p.length,b=n.length,k=y-g,x=k>0,w=d+(x?-k:0),E=w+Math.abs(k);if(!0===h&&!x){let t=u;for(let e=w;e<E;e++)p[e]===f&&(t+=f);e=e.slice(0,w)+t+e.slice(w,y)}const T=e.split(u).map(((e,t)=>({char:e,isNew:t>=w&&t<E})));for(let e=y-1;e>=0;e--){const{char:t}=T[e];if(t!==f){t===p[e>=w&&g===b?e-k:e]&&T.splice(e,1)}}let A=u,O=!1;e:for(let e=0;e<m;e++){const t=p[e];if(t===f){if(T.length>0)for(;T.length>0;){const{char:t,isNew:r}=T.shift();if(t===f&&!0!==v){A+=f;continue e}if(n[e].test(t)){if(!0===h&&!1!==r&&s!==u&&!1!==l&&x){const n=T.length;let r=null;for(let e=0;e<n;e++){const t=T[e];if(t.char!==f&&!1===t.isNew)break;if(t.char===f){r=e;break}}null!==r?(A+=t,T.splice(r,1)):e--}else A+=t;continue e}O=!0}!1===v&&(A+=p.substr(e,m));break}A+=t}if(v&&!1===x){let e=null;for(let t=0;t<A.length;t++)p[t]===f&&(e=t);A=null!==e?A.substr(0,e+1):u}return{conformedValue:A,meta:{someCharsRejected:O}}}var l=function(){return l=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},l.apply(this,arguments)},s={__nextCharOptional__:!0},f={"#":/\d/,A:/[a-z]/i,N:/[a-z0-9]/i,"?":s,X:/./},p=function(e){return t=e.toString().replace(/.(\/)[gmiyus]{0,6}$/,(function(e){return e.replace("/","?/")})),n=t.lastIndexOf("/"),new RegExp(t.slice(1,n),t.slice(n+1));var t,n},d=function(e){return e instanceof RegExp?e:function(e){return new RegExp("/[".concat(function(e){return"[\\^$.|?*+()".indexOf(e)>-1?"\\".concat(e):e}(e),"]/"))}(e)},h=function(e,t){return void 0===t&&(t=f),e?e.map((function(e,n,r){var o=t[e]||e,i=r[n-1],a=t[i]||i;return o===s?null:o&&a===s?p(d(o)):o})).filter(Boolean):[]},v=function(e,t){return Array.isArray(e)?function(e,t){void 0===t&&(t=f);var n=e.map((function(e){return e instanceof RegExp?e:"string"==typeof e?e.split(""):null})).filter(Boolean).reduce((function(e,t){return e.concat(t)}),[]);return h(n,t)}(e,t):g(e)?e:e&&m(e)&&e.length>0?function(e,t){return void 0===t&&(t=f),h(e.split(""),t)}(e,t):e},y=function(e){return e instanceof HTMLInputElement?e:e.querySelector("input")||e},g=function(e){return"function"==typeof e},m=function(e){return"string"==typeof e};var b,k,x,w=(b=new Map,k={previousValue:"",mask:[]},{get:x=function(e){return b.get(e)||l({},k)},remove:function(e){b.delete(e)},partiallyUpdate:function(e,t){b.set(e,l(l({},x(e)),t))}}),E=function(e){!function(e,t){var n=new CustomEvent(t,{bubbles:!0,cancelable:!0});e.dispatchEvent(n)}(e,"input")},T=function(e,t){void 0===t&&(t=!1);var n=e.value,r=w.get(e),o=r.previousValue,i=r.mask,a=n!==o,u=n.length>Number(null==o?void 0:o.length);if((t||n&&a&&u)&&i){var l=c(n,i,{guide:!1}).conformedValue;e.value=l,E(e)}w.partiallyUpdate(e,{previousValue:n})},A=function(e,t,n){var r=v(t,n);w.partiallyUpdate(e,{mask:r})},O=function(e){return(Array.isArray(e)?e:[e]).filter((function(e){return m(e)||e instanceof RegExp})).toString()},M=function(e){void 0===e&&(e={});var t,n,r=(t=e.placeholders,void 0===n&&(n=f),null===t||Array.isArray(t)||"object"!=typeof t?n:Object.keys(t).reduce((function(e,n){var r,o=t[n];return null===o||o instanceof RegExp?l(l({},e),((r={})[n]=o,r)):e}),n));return{beforeMount:function(e,t){e=y(e),A(e,t.value,r),T(e)},updated:function(e,t){e=y(e);var n=g(t.value)||O(t.oldValue)!==O(t.value);n&&A(e,t.value,r),T(e,n)},unmounted:function(e){e=y(e),w.remove(e)}}},V=M(),C={install:function(e,t){e.directive("mask",M(t))}};e.Vue3MaskDirective=V,e.Vue3MaskPlugin=C,e.default=C,Object.defineProperty(e,"__esModule",{value:!0})}));
